<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <title>D3 Practice - RECT</title>
  </head>
<body>
    <style>
    .legend{
      position:absolute;
      background: rgba(70,130,180,0.2);
      color:black;  padding: 6px;
      border-radius: 4px;
      border-color:black;
      border-width: 2px;
      border-style: solid;
      left:550px;
      top:100px;
      width:120px;
      height:90px;
      cursor: default;

    }
    .d3-tip {
      line-height: 1;
      padding: 6px;
      background: rgba(0, 0, 0, 0.8);
      color: #fff;
      border-radius: 4px;
      font-size: 15px;
      font-family:inherit;
    }
    </style>
    <script type="text/javascript">
      //Data
      var data=[10,200,30,150,44,73,100,320,30];

      //Canvas
      var w=800,h=650;
      var svg=d3.select('body').append("svg")
                   .attr('width',w).attr('height',h)//.style('background',"#f4f4f4")
                   .attr("transform","translate(50)")

      var canvas=svg.selectAll('rect').data(data);


      //Y-Scale & X-Scale
      var yscale=d3.scaleLinear()
                 .domain([0,d3.max(data)])
                 .range([0,w-400]);
      var xscale=d3.scaleBand()
                 .domain(d3.range(0,data.length))
                 .range([0,w-400]);


      //Tool Tip
      var tool_tip = d3.select("body").append("div").attr("class","d3-tip")
                    .style("border","0").style("border-radius","8px").style("position","absolute")
                    .style("background","black").style('color','white')
                    .style("visibility","hidden");


      //Rectangular Graphs
      var rectangles=canvas.enter()
                    .append("rect")
                    .attr('width',xscale.bandwidth())
                    .attr('height',0)
                    .attr('y',function(d){return 480;})
                    .attr('x',function(d,i){return xscale(i)+25;}).attr("transform","translate(60,20)")
                    .attr("class",function(d,i){if(d<=10) return "green";
                    if(d>10&&d<50) return "yellow";
                    if(d>50&&d<200) return "orange";
                    if(d>=200) return "red";})
                    .on("mouseover",function(event,d)
                    {
                      tool_tip.html(d).style("left", (event.pageX) + "px").style("top", (event.pageY-20) + "px")
                      .style("visibility","visible");
                      d3.select(this).style("opacity",0.5);
                      //console.log(event);
                    })
                    .on("mouseout",function(){
                      tool_tip.html('').style("visibility","hidden");
                      d3.select(this).style("opacity",1)
                    })
                    //transition
      var trans =  rectangles.transition()
                        .attr('height',function(d){return yscale(d)})
                        .attr('y',function(d){return 480-yscale(d);})
                        .attr('x',function(d,i){return xscale(i)+25;})
                        .style('fill',function(d,i){
                          if(d<=10) return "green";
                          if(d>10&&d<50) return "yellow";
                          if(d>50&&d<200) return "orange";
                          if(d>=200) return "red";
                        }).style("opacity",1).duration(500)

      //legends

      var colors=[{color:"green",data:"Safe"}
      ,{color:"yellow",data:"Acceptable"},{color:"orange",data:"Risky"}
      ,{color:"red",data:"Dangerous"}];
      var legend=d3.select("body").append("svg").attr("class","legend").selectAll('.legenditem').data(colors)

      legend.enter().append("circle")
                   .attr("class","legenditem").attr('r',5).attr('cx',10).attr('cy',15).attr("transform",function(d,i){
                     return "translate("+0+","+(i*20)+")";
                   }).style('fill', d => d.color)

      var f=function(d,c){
                     if(c=="green"){
                       if(d<=10) return 1;
                       if(d>10&&d<50) return 0.2;
                       if(d>50&&d<200) return 0.2;
                       if(d>=200) return 0.2;
                     }
                     if(c=="yellow"){
                       if(d<=10) return 0.2;
                       if(d>10&&d<50) return 1;
                       if(d>50&&d<200) return 0.2;
                       if(d>=200) return 0.2;
                     }
                     if(c=="orange"){
                       if(d<=10) return 0.2;
                       if(d>10&&d<50) return 0.2;
                       if(d>50&&d<200) return 1;
                       if(d>=200) return 0.2;
                     }
                     if(c=="red"){
                       if(d<=10) return 0.2;
                       if(d>10&&d<50) return 0.2;
                       if(d>50&&d<200) return 0.2;
                       if(d>=200) return 1;
                     }
       }
      legend.enter().append("text").attr('x',18).attr('y',function(d,i){return i*20;}).text(d => d.data)
                .attr("id",function(d){return d.data;}).attr("value","false")
                .attr("transform","translate(0,20)")
                .on("mouseover",function(){
                  d3.select(this).style("text-decoration","underline")
                })
                .on("mouseout",function(){
                  d3.select(this).style("text-decoration","none");
                })
                .on("click",function(event,d){
                  var c = d.color;
                  var el=document.getElementById(d.data);
                  //console.log(el)
                  var flag=el.hasAttribute("value");
                  if(flag==true){
                    d3.selectAll("text").style("fill","black");
                    d3.select(this).style("fill","red");
                    el.removeAttribute("value");
                    rectangles.style("opacity",function(d){return f(d,c);}).on("mouseout",function(event,d){
                        tool_tip.html('').style("visibility","hidden");
                        d3.select(this).style("opacity",f(d,c));
                    })
                  }
                  else{
                    d3.selectAll("text").style("fill","black");
                    rectangles.style("opacity",function(d){
                      if(c=="green"){
                        if(d<=10) return 1;
                        if(d>10&&d<50) return 1;
                        if(d>50&&d<200) return 1;
                        if(d>=200) return 1;
                      }
                    }).on("mouseout",function(event,d){
                        tool_tip.html('').style("visibility","hidden");
                        d3.select(this).style("opacity",1);
                    })
                    el.setAttribute("value","false");
                  }
                })

      //Axes-Initialization
      var hscale=d3.scaleBand()
                 .domain(d3.range(0,data.lengt))
                 .range([0,w-325]);
      var xaxis=d3.axisBottom().scale(xscale);
      var vscale=d3.scaleLinear()
                  .domain([0,d3.max(data)])
                  .range([h-250,0]);
      var yaxis=d3.axisLeft().scale(vscale).ticks(20);

      //Axes-Calling
      d3.select("svg").append('g').attr("transform","translate("+(25+60)+","+(20+480)+")").call(xaxis);
      d3.select("svg").append('g').attr("transform","translate("+(25+60)+","+(20+80)+")").call(yaxis);

      //Title of the chart
      svg.append("text").attr("transform","translate(250,40)").text("Sample Chart").style('font-family','fantasy').style('font-size',"30px");


      var el=document.getElementsByClassName("green")
      console.log(el)
    </script>
  </body>
</html>
